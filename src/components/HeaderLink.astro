---
const { href = "", class: className, ...props } = Astro.props;

const currentPath = Astro.url.pathname;
const base = import.meta.env.BASE_URL;

const normalize = (h: string) => {
  if (h.startsWith("http://") || h.startsWith("https://")) return h;
  if (h === "" || h === "/") return base;
  if (h.startsWith(base)) return h;
  if (h.startsWith("/")) return `${base}${h.slice(1)}`;
  return `${base}${h}`;
};

const normalizedHref = normalize(String(href));
const stripSlash = (s: string) => s.replace(/\/+$/, "");
const isActive = stripSlash(currentPath) === stripSlash(normalizedHref);
---

<a
  href={normalizedHref}
  class:list={[className, { active: isActive }]}
  {...props}
>
  <slot />
</a>
<style>
  a {
    display: inline-block;
    text-decoration: none;
  }
  a.active {
    font-weight: bolder;
    text-decoration: underline;
  }
</style>
